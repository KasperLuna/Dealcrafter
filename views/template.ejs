<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1"
      crossorigin="anonymous"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/boxicons@2.0.5/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/CSS/temp.css" />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"
      alt="/JS/Chart.min.js"
      integrity="sha512-d9xgZrVZpmmQlfonhQUvTR7lMPtO7NkZMkA0ABN3PHCbKA5nqylQ/yWlFAyY6hYgdF1Qh6nYiuADWwKB4C2WSw=="
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/boxicons@2.0.5/css/boxicons.min.css"
      rel="stylesheet"
    />
    <title>Document</title>
  </head>
  <body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://html2canvas.hertzen.com/dist/html2canvas.js"
    ></script>
    <script>
      function CreatePDFfromHTML() {
        var HTML_Width = $(".html-content").width();
        var HTML_Height = $(".html-content").height();
        var top_left_margin = 15;
        var PDF_Width = HTML_Width + top_left_margin * 2;
        var PDF_Height = PDF_Width * 1.5 + top_left_margin * 2;
        var canvas_image_width = HTML_Width;
        var canvas_image_height = HTML_Height;

        var totalPDFPages = Math.ceil(HTML_Height / PDF_Height) - 1;

        html2canvas($(".html-content")[0]).then(function (canvas) {
          var imgData = canvas.toDataURL("image/jpeg", 1.0);
          var pdf = new jsPDF("p", "pt", [PDF_Width, PDF_Height]);
          pdf.addImage(
            imgData,
            "JPG",
            top_left_margin,
            top_left_margin,
            canvas_image_width,
            canvas_image_height
          );
          for (var i = 1; i <= totalPDFPages; i++) {
            pdf.addPage(PDF_Width, PDF_Height);
            pdf.addImage(
              imgData,
              "JPG",
              top_left_margin,
              -(PDF_Height * i) + top_left_margin * 4,
              canvas_image_width,
              canvas_image_height
            );
          }
          pdf.save("Dealcrafter <%=curDate%> Report.pdf");
          $(".html-content").hide();
        });
      }
    </script>
    <center>
      <button id="cmd" onClick="CreatePDFfromHTML()">Download PDF</button>
      <button onclick="location.href='/report';"/>Return to Reports</button>
    </center>
    <div id="content" class="html-content">
      <container>
        <div class="row">
          <div class="col-md-6 col-sm-6 col-xs-6 col-lg-6">
            <img class="logo" src="/IMG/logo.png" />
          </div>
          <div class="col-md-6 col-sm-6 col-xs-6 col-lg-6 cont">
            <h1>Miguel Rellosa LLC</h1>
            8127 Homerun Champ Dr Las Vegas NV 89113<br />
            09202366875<br />
            Generated on: <%=curDate%><br />
            Generated by: <%=username%>
          </div>
        </div>
      </container>
      <h2>
        <b><center>Inventory Report ( <%=curDate%> )</center></b>
      </h2>
      <div class="container">
        <div class="row justify-content-md-center">
          <div class="col-md-6 col-sm-12 col-xs-12 col-lg-6">
            <canvas id="myChart"></canvas>
          </div>
          <div class="col-md-6 col-sm-12 col-xs-12 col-lg-6">
            <canvas id="myChart2"></canvas>
          </div>
        </div>

        <div class="row justify-content-md-center">
          <div class="col-md-12 col-sm-12 col-xs-12 col-lg-12">
            <canvas id="myChart3"></canvas>
          </div>
        </div>
      </div>

      <script>
        let myChart = document.getElementById("myChart").getContext("2d");

        let massPopChart = new Chart(myChart, {
            type:'pie',
            data:{
                <%
                var category = pie.map(function(item) { return item['category'];});
                var trimCateg = category.slice(0, 2);
                var categ = "'" + trimCateg.join("','") + "'";
                var pielength = pie.length;
                var categoryCount = [];
                var othersCount = [];
                var others;
                for (var i = 0; i< 2; i++){ categoryCount[i] = pie[i].categorycount; }
                for (var i = 2; i < pielength; i++){ othersCount[i] = parseInt(pie[i].categorycount)};
                others = othersCount.reduce((a, b) => a + b, 0);
                var categoryString = categoryCount.toString();
                var categoryInt = categoryString.split(',').map(Number);
                var categoryTotal = categoryInt.reduce(function(a, b) { return a + b; }, 0);
                var itemTotal = categoryTotal + others;
                //
                var category1Perc = categoryInt[0] / itemTotal;
                var category2Perc = categoryInt[1] / itemTotal;
                var otherPerc = others / itemTotal;
                //
                var category1Fin = category1Perc.toFixed(2);
                var category2Fin = category2Perc.toFixed(2);
                var other3Fin = otherPerc.toFixed(2);
                //
                var categoryOne = category1Fin * 100;
                var categoryTwo = category2Fin * 100;
                var otherThree = other3Fin * 100;
                %>

                labels:[<%-categ%>, 'Others'],
                datasets:[{
                    label:'Quantity',
                    data:[<%=categoryCount%>,<%=others%>],
                    backgroundColor:['#FF6633', '#FFB399', '#FF33FF', '#FFFF99'],
                    borderWidth:2,
                    borderColor: '#777'
                }]
            },
            options:{
                title:{
                    display:true,
                    text:'Top 3 Categories by Item Entries',
                    fontSize:20
                }
            }
        });

        let myChart2 = document.getElementById("myChart2").getContext("2d");

        let massPopChart2 = new Chart(myChart2, {
          type: "horizontalBar",
          data: {
            labels: [
              "<%=queryData1[0].item_name%>",
              "<%=queryData1[1].item_name%>",
              "<%=queryData1[2].item_name%>",
              "<%=queryData1[3].item_name%>",
              "<%=queryData1[4].item_name%>",
            ],
            datasets: [
              {
                label: "Quantity",
                data: [
                  "<%=queryData1[0].quantity%>",
                  "<%=queryData1[1].quantity%>",
                  "<%=queryData1[2].quantity%>",
                  "<%=queryData1[3].quantity%>",
                  "<%=queryData1[4].quantity%>",
                ],
                backgroundColor: "#2A9D8F",
                borderWidth: 2,
                borderColor: "#777",
              },
            ],
          },
          options: {
            title: {
              display: true,
              text: "Highest Number Of Items",
              fontSize: 20,
            },
          },
        });

        let myChart3 = document.getElementById("myChart3").getContext("2d");

        let massPopChart3 = new Chart(myChart3, {
            type:'line',
            data:{
                labels:['<%=dateArr[6].slice(0, 10)%>','<%=dateArr[5].slice(0, 10)%>', '<%=dateArr[4].slice(0, 10)%>', '<%=dateArr[3].slice(0, 10)%>', '<%=dateArr[2].slice(0, 10)%>', '<%=dateArr[1].slice(0, 10)%>', '<%=dateArr[0].slice(0, 10)%>'],
                datasets:[{
                    label:'Quantity',
                    data:[
                        <%=countArr[6]%>,
                        <%=countArr[5]%>,
                        <%=countArr[4]%>,
                        <%=countArr[3]%>,
                        <%=countArr[2]%>,
                        <%=countArr[1]%>,
                        <%=countArr[0]%>
                    ],
                    backgroundColor:'transparent',
                    borderWidth:3,
                    borderColor: '#2A9D8F'
                }]
            },
            options:{
                title:{
                    display:true,
                    text:'Total Added Items For the Last 7 Days',
                    fontSize:20
                }
            }
        });
      </script>
      <br /><br />
      <div class="interp">
        <p>
          The top two (2) item categories based on percentage share include
          <%=trimCateg[0]%>(s) having <%=categoryOne%>% percent share,
          <%=trimCateg[1]%> with <%=categoryTwo%>% share, and Other items make
          up the remaining <%=otherThree%>% share.
        </p>
        <p>
          The highest quantity of items at Top 1 is <%=queryData1[0].item_name%>
          with <%=queryData1[0].quantity%> pieces, Top 2 is
          <%=queryData1[1].item_name%> having <%=queryData1[1].quantity%>
          pieces, <%=queryData1[2].item_name%> is Top 3 having
          <%=queryData1[2].quantity%> pieces, Top 4 is
          <%=queryData1[3].item_name%> having <%=queryData1[3].quantity%>
          pieces, and lastly Top 5 is <%=queryData1[4].item_name%> having
          <%=queryData1[4].quantity%> pieces.
        </p>
        <% var numString = countArr.toString(); var numArray =
        numString.split(',').map(Number); %>
        <p>
          The total quantity of items for the last seven (7) day shows that 6
          days ago, <%=countArr[6]%> items were added. Following that,
          <%=countArr[5]%> items. Four days ago, <%=countArr[4]%> items. Three
          days ago, <%=countArr[3]%> items. Two days ago, <%=countArr[2]%>
          items. Yesterday, <%=countArr[1]%> items were added. Today,
          <%=countArr[0]%> items have been added. As of today, the total
          quantity of items added in the past 7 days is
          <%=numArray.reduce(function(a, b) { return a + b; }, 0);%>.
        </p>
      </div>
      <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
        alt="/JS/bootstrap.bundle.min.js"
        integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
        crossorigin="anonymous"
      ></script>
    </div>
  </body>
</html>
